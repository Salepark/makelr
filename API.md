# Makelr API

This document describes the public and internal REST API of Makelr.

Makelr’s API is designed around a few core principles:

- All requests are **user-scoped**
- The **Bot** is the unit of automation
- **Presets** are onboarding helpers
- **Sources** are inputs to workflows
- **Threads** power the Console (command control)
- **LLM Providers** are user-owned and optional (BYO LLM)

Unless stated otherwise, all endpoints:
- Use JSON
- Are authenticated
- Are scoped to the current user

---

## Base URL

/api


---

## Authentication

Authentication is handled by the application’s configured auth provider.

All API endpoints:
- Assume an authenticated user
- Enforce user-level scoping on every query
- Never allow cross-user access

If a request is not authenticated, the API returns:

401 Unauthorized


---

## Conventions

### Request / Response

- Content-Type: `application/json`
- All timestamps are ISO 8601 strings
- IDs are opaque strings or integers depending on storage layer

### Error Format (Typical)

{
"error": "Human readable message"
}


---

## 1. System

### GET /api/system/status

Returns basic system status, including LLM availability.

Response:

{
"hasSystemLLM": true,
"version": "x.y.z"
}


---

## 2. Presets

Presets are workflow recipes used for onboarding.

### GET /api/presets

List available presets.

Response:

[
{
"id": "preset-id",
"key": "community-research",
"name": "Community Research Helper",
"description": "...",
"defaultConfig": { ... }
}
]


---

## 3. Bots

Bots represent workflow configurations.

### GET /api/bots

List all bots for the current user.

Response:

[
{
"id": "bot-id",
"key": "investing",
"name": "My Investing Bot",
"status": "active"
}
]


---

### POST /api/bots/from-preset

Create a bot from a preset (atomic operation).

Request:

{
"presetId": "preset-id",
"topic": "investing",
"name": "My Bot",
"customSources": [
{ "name": "My Feed", "url": "https://example.com/rss" }
]
}


Response:

{
"botId": "new-bot-id"
}


---

### GET /api/bots/:botId

Get full bot detail.

---

### PUT /api/bots/:botId/settings

Update bot settings.

Request (example):

{
"schedule": "daily",
"format": "brief",
"llmProviderId": "provider-id-or-null",
"modelOverride": "optional-model-name"
}


---

### DELETE /api/bots/:botId

Delete a bot and all related data.

---

## 4. Sources

Sources are input feeds for bots.

### GET /api/bots/:botId/sources

List sources attached to a bot.

---

### POST /api/bots/:botId/sources

Add a new source to a bot.

Request:

{
"name": "Hacker News",
"url": "https://news.ycombinator.com/rss"
}


---

### DELETE /api/bots/:botId/sources/:sourceId

Remove a source from a bot.

---

## 5. LLM Providers (BYO LLM)

Users can manage their own AI providers.

### GET /api/llm-providers

List user’s LLM providers.

---

### POST /api/llm-providers

Create a new provider.

Request:

{
"name": "My OpenAI",
"type": "openai",
"apiKey": "sk-...",
"baseUrl": "optional",
"defaultModel": "optional"
}


Note:
- `apiKey` is encrypted at rest
- It is never returned in plaintext

---

### DELETE /api/llm-providers/:providerId

Delete a provider.

Bots referencing this provider will fall back to:
- System LLM, or
- Null (and block LLM operations)

---

## 6. Pipeline / Execution

### POST /api/bots/:botId/run

Trigger a bot workflow manually.

Response:

{ "ok": true }


If no LLM is available, returns an error.

---

### POST /api/bots/:botId/pause

Pause scheduled execution.

---

### POST /api/bots/:botId/resume

Resume scheduled execution.

---

## 7. Reports / Outputs

### GET /api/bots/:botId/reports

List reports generated by a bot.

---

### GET /api/reports/:reportId

Get a specific report.

---

## 8. Console (Command System)

The Console is a thread-based command interface.

### GET /api/threads

List threads for the current user.

---

### POST /api/threads

Create a new thread.

---

### GET /api/threads/:threadId/messages

List messages in a thread.

---

### POST /api/threads/:threadId/messages

Send a message (command or text).

Request:

{
"content": "run now"
}


Response may include:
- A normal message
- A clarification request
- A confirmation request

---

### POST /api/threads/:threadId/confirm

Confirm a pending action.

Request:

{
"messageId": "pending-message-id",
"approved": true
}


---

## 9. Security Model (API Level)

- Every endpoint:
  - Validates authentication
  - Enforces userId scoping
- Bots, sources, threads, messages:
  - Cannot be accessed across users
- Secrets:
  - Never returned
  - Always encrypted at rest
- Destructive actions:
  - Often require confirmation (via Console flow)

---

## 10. What Is Not API-Stable

The following may change without notice:

- Internal pipeline job endpoints
- Internal admin or debug routes
- Experimental preset or report formats

Public, user-facing routes documented here aim to remain stable.

---

## 11. Summary

The Makelr API is built around:

- User-owned workflows (Bots)
- Composable inputs (Sources)
- Optional AI providers (BYO LLM)
- Explicit execution (Pipeline)
- Safe control (Console + Threads)

It is designed to be:

- Predictable
- Inspectable
- Secure by default
- Extensible over time

---

Makelr — Build Your Automation, Your Way.
